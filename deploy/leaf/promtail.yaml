clients:
  - backoff_config:
      min_period: 50ms
      max_retries: 2
    batchwait: 1s
    timeout: 1s
    url: http://localhost:8003/loki/api/v1/push
scrape_configs:
  - exporter:
      metrics_allowed:
        - node_cpu_seconds_total
        - node_load1
        - node_network_receive_bytes_total
        - node_network_transmit_bytes_total
        - node_memory_MemTotal_bytes
        - node_memory_MemFree_bytes
        - node_memory_Cached_bytes
        - node_memory_Buffers_bytes
      scrape_interval: 500ms
      timeout: 400ms
    job_name: metrics
    kubernetes_sd_configs:
      - role: pod
    pipeline_stages: []
    relabel_configs:
      - action: keep
        regex: default
        source_labels:
          - __meta_kubernetes_namespace
      - action: keep
        regex: .*-metrics-s
        source_labels:
          - __meta_kubernetes_pod_container_port_name
      - action: drop
        regex: ""
        source_labels:
          - __meta_kubernetes_pod_label_name
      - action: drop
        regex: Succeeded|Failed
        source_labels:
          - __meta_kubernetes_pod_phase
      - action: drop
        regex: "false"
        source_labels:
          - __meta_kubernetes_pod_annotation_prometheus_io_scrape
      - source_labels:
          - __meta_kubernetes_pod_label_name
        target_label: __service__
      - source_labels:
          - __meta_kubernetes_pod_node_name
        target_label: __node__
      - action: drop
        regex: ""
        source_labels:
          - __service__
      - action: replace
        replacement: $1
        separator: /
        source_labels:
          - __meta_kubernetes_namespace
          - __service__
        target_label: job
      - action: replace
        source_labels:
          - __meta_kubernetes_namespace
        target_label: namespace
      - action: replace
        source_labels:
          - __meta_kubernetes_pod_name
        target_label: pod
      - action: replace
        source_labels:
          - __meta_kubernetes_pod_container_name
        target_label: container
      - action: replace
        regex: (.+?)\:(\d+)
        replacement: $1
        source_labels:
          - __address__
        target_label: __host__
      - action: replace
        regex: (.+?)\:(\d+)
        replacement: $2
        source_labels:
          - __address__
        target_label: __port__
      - target_label: host
        replacement: ${HOSTNAME}